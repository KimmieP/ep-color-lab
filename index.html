<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The EP Color Lab</title>
    <style>
        :root {
            --bg-color: #050510;
            --card-bg: #131325;
            --accent-primary: #00f3ff;
            --accent-secondary: #bc13fe;
            --text-main: #ffffff;
            --text-muted: #8888aa;
            --font-display: 'Courier New', Courier, monospace;
            --font-body: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        /* ADA FIX: High Contrast Focus Ring for Keyboard Users */
        *:focus-visible {
            outline: 2px solid var(--accent-primary);
            outline-offset: 4px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-body);
            display: flex; flex-direction: column; min-height: 100vh; padding: 20px;
        }
        header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 20px; }
        h1 {
            font-family: var(--font-display); text-transform: uppercase; letter-spacing: 4px;
            color: var(--accent-primary); text-shadow: 0 0 15px rgba(0, 243, 255, 0.4);
            font-size: 1.8rem; margin-bottom: 5px;
        }
        .subtitle { color: var(--accent-secondary); font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; }
        
        .main-container {
            display: grid; grid-template-columns: 1fr; gap: 20px; max-width: 800px; margin: 0 auto; width: 100%;
        }
        @media (min-width: 768px) {
            .main-container { grid-template-columns: 1fr 1fr; }
            .harmonies-section, .ai-palette-section { grid-column: 1 / -1; }
        }
        
        .card {
            background-color: var(--card-bg); border: 1px solid #333; border-radius: 12px;
            padding: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        h2 {
            font-family: var(--font-display); color: var(--accent-secondary); font-size: 1.2rem;
            margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; text-align: center;
        }
        
        /* Controls */
        .picker-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        
        /* ADA FIX: Picker needs label association */
        label.sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); border: 0;
        }

        input[type="color"] {
            -webkit-appearance: none; border: none; width: 150px; height: 150px;
            border-radius: 50%; cursor: pointer; background: none;
            box-shadow: 0 0 25px rgba(188, 19, 254, 0.2); transition: transform 0.2s;
        }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 4px solid var(--accent-secondary); border-radius: 50%; }
        input[type="color"]:hover { transform: scale(1.05); }

        .hex-input-group {
            display: flex; align-items: center; background: #000; border: 1px solid var(--accent-secondary);
            border-radius: 8px; padding: 10px 15px; width: 100%; max-width: 250px;
        }
        .hash { color: var(--accent-primary); font-family: var(--font-display); margin-right: 10px; }
        input[type="text"] {
            background: transparent; border: none; color: var(--text-main);
            font-family: var(--font-display); font-size: 1.2rem; width: 100%; outline: none;
            text-transform: uppercase; letter-spacing: 2px;
        }
        /* ADA FIX: Restore focus ring for text input but keep it subtle */
        input[type="text"]:focus { outline: none; } 
        .hex-input-group:focus-within { box-shadow: 0 0 0 2px var(--accent-primary); }
        
        /* Data Rows */
        .value-row {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;
            margin-bottom: 15px; border-left: 3px solid transparent; transition: all 0.2s;
        }
        .value-row:hover { border-left: 3px solid var(--accent-primary); background: rgba(255,255,255,0.05); }
        .label { color: var(--text-muted); font-size: 0.7rem; margin-bottom: 5px; text-transform: uppercase; }
        .data { font-family: var(--font-display); font-size: 1rem; color: var(--text-main); }
        .preview-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; border: 1px solid #555; }
        
        /* Harmonies */
        .harmony-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 20px; margin-top: 20px; }
        .harmony-group { text-align: center; }
        .harmony-title { font-size: 0.8rem; color: var(--accent-primary); margin-bottom: 10px; text-transform: uppercase; }
        .swatch-container { display: flex; justify-content: center; gap: 10px; }
        
        /* ADA FIX: Swatches are now buttons */
        .swatch {
            width: 50px; height: 50px; border-radius: 10px; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1); transition: transform 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            appearance: none; padding: 0; /* Reset button styles */
        }
        .swatch:hover { transform: scale(1.1); border-color: var(--text-main); }

        /* --- PALETTE GENERATOR STYLES --- */
        .controls-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;
        }
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        
        /* ADA FIX: Labels need to be explicitly associated */
        label { color: var(--text-muted); font-size: 0.7rem; margin-bottom: 5px; text-transform: uppercase; display: block; }
        
        select, input[type="range"] {
            background: #000; color: var(--text-main); border: 1px solid var(--accent-secondary);
            padding: 8px; border-radius: 5px; font-family: var(--font-body); width: 100%; cursor: pointer;
        }
        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            height: 10px; background: #333; border: none; border-radius: 5px; box-shadow: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px; background: var(--accent-primary);
            border-radius: 50%; cursor: pointer;
        }
        button#genBtn {
            width: 100%; padding: 10px; background: var(--accent-primary); color: #000;
            font-weight: bold; border: none; border-radius: 5px; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.2s;
            font-family: var(--font-body);
        }
        button#genBtn:hover { background: #fff; box-shadow: 0 0 15px var(--accent-primary); }
        
        .palette-output { margin-top: 20px; display: flex; flex-direction: column; gap: 0; }
        
        /* ADA FIX: Palette bars are now buttons */
        .palette-bar {
            padding: 10px 15px; font-family: var(--font-display); font-size: 0.9rem;
            color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.8);
            cursor: pointer; transition: padding 0.2s;
            display: flex; justify-content: space-between;
            width: 100%; border: none; text-align: left; /* Reset button styles */
            align-items: center;
        }
        .palette-bar:first-child { border-top-left-radius: 8px; border-top-right-radius: 8px; }
        .palette-bar:last-child { border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; }
        .palette-bar:hover { padding-left: 25px; }

        footer { margin-top: auto; text-align: center; padding-top: 40px; font-size: 0.7rem; color: var(--text-muted); letter-spacing: 1px; padding-bottom: 20px; }
    </style>
</head>
<body>

    <header>
        <h1>The EP Color Lab</h1>
        <div class="subtitle">Real-Time Color Conversion</div>
    </header>

    <div class="main-container">
        <div class="card">
            <h2>Select Color</h2>
            <div class="picker-container">
                <label for="colorPicker" class="sr-only">Main Color Picker</label>
                <input type="color" id="colorPicker" value="#FF00A2">
                
                <div class="hex-input-group">
                    <span class="hash" aria-hidden="true">#</span>
                    <label for="hexInput" class="sr-only">Hex Code Input</label>
                    <input type="text" id="hexInput" value="FF00A2" maxlength="6">
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Converted Values</h2>
            <div class="value-row">
                <div><span class="label">HEX</span><div><span class="preview-dot" id="dotHex" aria-hidden="true"></span><span class="data" id="valHex">#FF00A2</span></div></div>
            </div>
            <div class="value-row">
                <div><span class="label">RGB</span><div><span class="preview-dot" id="dotRGB" aria-hidden="true"></span><span class="data" id="valRGB">rgb(255, 0, 162)</span></div></div>
            </div>
            <div class="value-row">
                <div><span class="label">CMYK</span><div><span class="preview-dot" id="dotCMYK" aria-hidden="true"></span><span class="data" id="valCMYK">cmyk(0%, 100%, 36%, 0%)</span></div></div>
            </div>
        </div>

        <div class="card harmonies-section">
            <h2>Color Harmonies</h2>
            <div class="harmony-grid">
                <div class="harmony-group">
                    <div class="harmony-title">Complementary</div>
                    <div class="swatch-container" id="container-comp"></div>
                </div>
                <div class="harmony-group">
                    <div class="harmony-title">Analogous</div>
                    <div class="swatch-container" id="container-ana"></div>
                </div>
                <div class="harmony-group">
                    <div class="harmony-title">Triadic</div>
                    <div class="swatch-container" id="container-tri"></div>
                </div>
            </div>
        </div>

        <div class="card ai-palette-section">
            <h2>Palette Generator</h2>
            
            <div class="controls-grid">
                <div class="control-group">
                    <label for="schemeSelect">Color Scheme</label>
                    <select id="schemeSelect">
                        <option value="split-complementary">Split-Complementary</option>
                        <option value="monochromatic">Monochromatic</option>
                        <option value="analogous">Analogous</option>
                        <option value="triadic">Triadic</option>
                        <option value="tetradic">Tetradic</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="countSlider">Color Count: <span id="countVal">5</span></label>
                    <input type="range" id="countSlider" min="3" max="12" value="5">
                </div>
            </div>

            <button id="genBtn">Generate Palette</button>

            <div class="palette-output" id="paletteOutput">
                </div>
        </div>
    </div>

    <footer>
        Powered by Elevated Philosophy Brand LLC <br>
        <span style="opacity: 0.6; font-size: 0.6rem;">WCAG 2.1 Compliant â€¢ Accessibility Ready</span>
    </footer>

    <script>
        // --- Core Elements ---
        const picker = document.getElementById('colorPicker');
        const hexIn = document.getElementById('hexInput');
        const slider = document.getElementById('countSlider');
        const countVal = document.getElementById('countVal');
        const genBtn = document.getElementById('genBtn');
        const schemeSelect = document.getElementById('schemeSelect');

        // --- Init ---
        setTimeout(() => {
            updateAll(picker.value);
            generatePalette(); 
        }, 100);

        // --- Event Listeners ---
        picker.addEventListener('input', (e) => {
            hexIn.value = e.target.value.substring(1).toUpperCase();
            updateAll(e.target.value);
        });

        hexIn.addEventListener('input', (e) => {
            let val = e.target.value;
            if(val.length === 6 && /^[0-9A-Fa-f]{6}$/.test(val)) {
                updateAll('#' + val);
                picker.value = '#' + val;
            }
        });

        schemeSelect.addEventListener('change', (e) => {
            let scheme = e.target.value;
            let recommended = 5;
            
            if (scheme === 'triadic' || scheme === 'split-complementary') recommended = 3;
            else if (scheme === 'tetradic') recommended = 4;
            
            slider.value = recommended;
            countVal.innerText = recommended;
            generatePalette();
        });

        slider.addEventListener('input', (e) => {
            countVal.innerText = e.target.value;
        });

        genBtn.addEventListener('click', generatePalette);

        // --- Main Update Function ---
        function updateAll(hex) {
            document.getElementById('valHex').textContent = hex.toUpperCase();
            document.getElementById('dotHex').style.backgroundColor = hex;
            
            let r = parseInt(hex.substr(1,2),16), g = parseInt(hex.substr(3,2),16), b = parseInt(hex.substr(5,2),16);
            document.getElementById('valRGB').textContent = `rgb(${r}, ${g}, ${b})`;
            document.getElementById('dotRGB').style.backgroundColor = hex;

            let c = 1-(r/255), m = 1-(g/255), y = 1-(b/255), k = Math.min(c, m, y);
            if(k<1) { c=(c-k)/(1-k); m=(m-k)/(1-k); y=(y-k)/(1-k); } else { c=0; m=0; y=0; }
            document.getElementById('valCMYK').textContent = `cmyk(${Math.round(c*100)}%, ${Math.round(m*100)}%, ${Math.round(y*100)}%, ${Math.round(k*100)}%)`;
            document.getElementById('dotCMYK').style.backgroundColor = hex;

            const hsl = rgbToHsl(r,g,b);
            renderSwatches('container-comp', [ hslToHex((hsl.h+180)%360, hsl.s, hsl.l) ]);
            renderSwatches('container-ana', [ hslToHex((hsl.h+330)%360, hsl.s, hsl.l), hslToHex((hsl.h+30)%360, hsl.s, hsl.l) ]);
            renderSwatches('container-tri', [ hslToHex((hsl.h+120)%360, hsl.s, hsl.l), hslToHex((hsl.h+240)%360, hsl.s, hsl.l) ]);
        }

        // --- Palette Generator Logic ---
        function generatePalette() {
            const hex = picker.value;
            const rgb = hexToRgb(hex);
            const hsl = rgbToHsl(rgb.r, rgb.g, rgb.b);
            const scheme = schemeSelect.value;
            const count = parseInt(slider.value);
            const container = document.getElementById('paletteOutput');
            
            container.innerHTML = ''; 

            let colors = [];
            
            for (let i = 0; i < count; i++) {
                let newH = hsl.h;
                let newS = hsl.s;
                let newL = hsl.l;

                // Smart Loop Logic
                let baseSize = 3; // default
                if(scheme === 'tetradic') baseSize = 4;
                if(scheme === 'monochromatic') baseSize = 100;

                if (i >= baseSize && baseSize < 100) {
                     let variant = Math.floor(i / baseSize);
                     let loopIndex = i % baseSize;
                     if(variant % 2 === 1) newL = Math.max(15, newL - 25);
                     else newL = Math.min(95, newL + 25);
                }

                if (scheme === 'monochromatic') {
                    newL = Math.max(10, Math.min(95, hsl.l + (i * 10 - (count*5))));
                } else if (scheme === 'analogous') {
                    newH = (hsl.h + (i * 30 - 30)) % 360;
                } else if (scheme === 'split-complementary') {
                    if (i % 3 === 0) { /* Base */ }
                    else if (i % 3 === 1) { newH = (hsl.h + 150) % 360; }
                    else if (i % 3 === 2) { newH = (hsl.h + 210) % 360; }
                } else if (scheme === 'triadic') {
                    newH = (hsl.h + (i * 120)) % 360;
                } else if (scheme === 'tetradic') {
                    newH = (hsl.h + (i * 90)) % 360;
                }
                
                colors.push(hslToHex(newH, newS, newL));
            }

            colors.forEach(c => {
                // ADA FIX: Use button element for keyboard accessibility
                const bar = document.createElement('button');
                bar.className = 'palette-bar';
                bar.style.backgroundColor = c;
                bar.innerHTML = `<span>${c.toUpperCase()}</span>`;
                bar.style.color = getContrastYIQ(c);
                bar.setAttribute('aria-label', `Select color ${c}`);
                
                bar.onclick = () => {
                    picker.value = c;
                    hexIn.value = c.substring(1).toUpperCase();
                    updateAll(c);
                };
                container.appendChild(bar);
            });
        }

        // --- Helpers ---
        function hexToRgb(hex) {
            let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : null;
        }

        function renderSwatches(id, colors) {
            const el = document.getElementById(id); el.innerHTML = '';
            colors.forEach(c => {
                // ADA FIX: Use button element
                let s = document.createElement('button'); 
                s.className = 'swatch'; 
                s.style.backgroundColor = c;
                s.setAttribute('aria-label', `Select harmony color ${c}`);
                s.onclick = () => { picker.value = c; hexIn.value = c.substring(1).toUpperCase(); updateAll(c); };
                el.appendChild(s);
            });
        }

        function rgbToHsl(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            let max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            if (max === min) { h = s = 0; } else {
                let d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                } h /= 6;
            } return { h: h * 360, s: s * 100, l: l * 100 };
        }

        function hslToHex(h, s, l) {
            if (h < 0) h += 360;
            l /= 100; const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }

        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            var r = parseInt(hexcolor.substr(0,2),16);
            var g = parseInt(hexcolor.substr(2,2),16);
            var b = parseInt(hexcolor.substr(4,2),16);
            var yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? 'black' : 'white';
        }
    </script>
</body>
</html>